

### 常见的 NoSQL 方案分为 4 类。

~~~
K-V 存储：解决关系数据库无法存储数据结构的问题，以 Redis 为代表。
文档数据库：解决关系数据库强 schema 约束的问题，以 MongoDB 为代表。
列式数据库：解决关系数据库大数据场景下的 I/O 问题，以 HBase 为代表。
全文搜索引擎：解决关系数据库的全文搜索性能问题，以 Elasticsearch 为代表。
~~~



#### 1、redis

**redis的优缺点**

~~~
Redis 的缺点主要体现在
	并不支持完整的 ACID 事务，Redis 虽然提供事务功能，但 Redis 的事务和关系数据库的事务不可同日而语，Redis 的事务只能保证隔离性和一致性（I 和 C），无法保证原子性和持久性（A 和 D）。
~~~

#### 2、**文档数据库**

~~~
为了解决关系数据库 schema 带来的问题，文档数据库应运而生。
文档数据库最大的特点就是 no-schema，可以存储和读取任意的数据。
目前绝大部分文档数据库存储的数据格式是 JSON（或者 BSON），因为 JSON 数据是自描述的，无须在使用前定义字段，读取一个 JSON 中不存在的字段也不会导致 SQL 那样的语法错误。	
~~~

**文档数据库的 no-schema 特性，给业务开发带来了几个明显的优势。**

~~~
1. 新增字段简单
2. 历史数据不会出错
3. 可以很容易存储复杂数据
~~~

**文档数据库的缺点**

~~~
1、文档数据库不支持事务
2、文档数据库无法实现关系数据库的join操作
~~~

### 3、列式数据库

**关系数据库按照行式来存储数据，主要有以下几个优势：**

~~~
1、业务同时读取多个列时效率高，因为这些列都是按行存储在一起的，一次磁盘操作就能够把一行数据中的各个列都读取到内存中。
2、能够一次性完成对一行中的多个列的写操作，保证了针对行数据写操作的原子性和一致性；否则如果采用列存储，可能会出现某次写操作，有的列成功了，有的列失败了，导致数据不一致。
~~~

**列式存储的优势**

~~~
1、如果查询不需要用到一行中的所有列，这就可以节省I/O的性能了
2、有更高的压缩比
	能够节省更多的存储空间。普通的行式数据库一般压缩率在 3:1 到 5:1 左右，而列式数据库的压缩率一般在 8:1 到 30:1 左右，因为单个列的数据相似度相比行来说更高，能够达到更高的压缩率。
~~~

**列式存储的劣势**

​	如果场景发生变化，列式存储的优势又会变成劣势

~~~
1、典型的场景是需要频繁地更新多个列。
	因为列式存储将不同列存储在磁盘上不连续的空间，导致更新多个列时磁盘是随机写操作；
	而行式存储时同一行多个列都存储在连续的空间，一次磁盘写操作就可以完成，列式存储的随机写效率要远远低于行式存储的写效率。
2、列式存储高压缩率在更新场景下也会成为劣势
	因为更新时需要将存储数据解压后更新，然后再压缩，最后写入磁盘。
~~~

​	**基于上述列式存储的优缺点，一般将列式存储应用在离线的大数据分析和统计场景中，因为这种场景主要是针对部分列单列进行操作，且数据写入后就无须再更新删除。**



#### 全文搜索引擎

~~~
传统的关系型数据库通过索引来达到快速查询的目的，但是在全文搜索的业务场景下，索引也无能为力，主要体现在：
	1、全文搜索的条件可以随意排列组合，如果通过索引来满足，则索引的数量会非常多。
	2、全文搜索的模糊匹配方式，索引无法满足，只能用 like 查询，而 like 查询是整表扫描，效率非常低。
~~~



**倒排索引和正排索引**

~~~
倒排索引也常被称为反向索引、置入档案或反向档案，是一种索引方法，其基本原理是建立单词到文档的索引。
之所以被称为“倒排”索引，是和“正排“索引相对的，
“正排索引”的基本原理是建立文档到单词的索引。
	e.g.:文章ID，文章名称，文章内容
	正排索引适用于根据文档名称来查询文档内容例如，用户在网站上单击了“面向对象葵花宝典是什么”，网站根据文章标题查询文章的内容展示给用户。
“倒排索引”
	e.g.:单词，文档ID列表
	
	倒排索引适用于根据关键词来查询文档内容。例如，用户只是想看“设计”相关的文章，网站需要将文章内容中包含“设计”一词的文章都搜索出来展示给用户。
~~~







#### 思考：NoSQL数据库和关系型数据的选型

~~~
关于NoSQL，看过一张图，挺形象：“1970，We have no SQL”->“1980，Know SQL”->“2000，NoSQL”->“2005，Not only SQL”->“2015，No，SQL”。目前，一些新型数据库，同时具备了NoSQL的扩展性和关系型数据库的很多特性。
       关系型和NoSQL数据库的选型。考虑几个指标，数据量、并发量、实时性、一致性要求、读写分布和类型、安全性、运维性等。根据这些指标，软件系统可分成几类。
       1.管理型系统，如运营类系统，首选关系型。
       2.大流量系统，如电商单品页的某个服务，后台选关系型，前台选内存型。
       3.日志型系统，原始数据选列式，日志搜索选倒排索引。
       4.搜索型系统，指站内搜索，非通用搜索，如商品搜索，后台选关系型，前台选倒排索引。
       5.事务型系统，如库存、交易、记账，选关系型+缓存+一致性协议，或新型关系数据库。
       6.离线计算，如大量数据分析，首选列式，关系型也可以。
       7.实时计算，如实时监控，可以选时序数据库，或列式数据库。
~~~

<img src="/Users/admin/Library/Application Support/typora-user-images/image-20210512203010372.png" alt="image-20210512203010372" style="zoom:30%;" />

​																						https://i.imgur.com/lkG9Vm8.jpg

